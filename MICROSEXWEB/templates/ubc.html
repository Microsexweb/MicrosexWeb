<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>UBC</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous" />
</head>

<body style="background-color: #2C3140; overflow-x: hidden;">

  <!-- Navbar -->
  <nav class="navbar" style="background-color: #09090D;">
    <div class="container-fluid">
      <a class="btn btn-secondary" href="#" class="navbar-item">Logout</a>
      <div class="d-flex">
        <a class="btn" href="#" style="color: #d9d9d9;">BLOG</a>
        <a class="btn" href="#" style="color: #D9D9D9;">About Us</a>
      </div>
    </div>
  </nav>

  <!-- Body -->
  <div class="container pt-5" style="color: #D9D9D9;">
    <h1>UBC</h1>
    <h4>Unidad Basica de Calculo</h4>
    <br /><br />

    <!-- Formulario -->
    <form method="POST" action="{{ url_for('ubc') }}">

      <!-- ...existing code... -->
      <div class="row">
        <div class="col">
          <label for="def">Definicion de variables</label>
        </div>
        <div class="col" style="font-size: 20px;">
          <span>Hexadecimal</span>
        </div>
        <div class="col" style="font-size: 20px;">
          <span>Binario</span>
        </div>
        <div class="col" style="font-size: 20px;">
          <span>Decimal</span>
        </div>
        <div class="col" style="font-size: 20px;">
          <span>Dec. Signado</span>
        </div>
      </div>

      <div class="row pt-3">
        <div class="col">
          <label>VARIABLE A</label>
        </div>

        <div class="col justify-content-center">
          <input type="text" name="var_a" id="var_a" placeholder="Ej 0A" maxlength="2"
            style="border: 2px solid #D9D9D9; border-radius: 20px; width: 100px; text-align: center; color: #09090D; background-color: #a4a5a6;"
            class="m-2" required value="{{ var_a or '' }}">
        </div>

        <div class="col justify-content-center">
          <label id="bin_a" for="Bin" style="text-align: center;">{{ val_bina or '00000000' }}</label>
        </div>
        <div class="col justify-content-center">
          <label id="dec_a" for="Dec" style="text-align: center;">{{ val_deci or '0' }}</label>
        </div>
        <div class="col justify-content-center">
          <label id="sdec_a" for="Signado" style="text-align: center;">{{ val_signado or '0' }}</label>
        </div>
      </div>

      <div class="row pt-3">
        <div class="col">
          <label>VARIABLE B</label>
        </div>

        <div class="col justify-content-center">
          <input type="text" name="var_b" id="var_b" placeholder="Ej 01" maxlength="2"
            style="border: 2px solid #D9D9D9; border-radius: 20px; width: 100px; text-align: center; color: #09090D; background-color: #a4a5a6;"
            class="m-2" required value="{{ var_b or '' }}">
        </div>
        <div class="col justify-content-center">
          <label id="bin_b" for="Bin" style="text-align: center;">{{ val_bbinb or '00000000' }}</label>
        </div>
        <div class="col justify-content-center">
          <label id="dec_b" for="Dec" style="text-align: center;">{{ val_decb or '0' }}</label>
        </div>
        <div class="col justify-content-center">
          <label id="sdec_b" for="Signado" style="text-align: center;">{{ val_signb or '0' }}</label>
        </div>
      </div>

      <div class="row align-items-end pt-5">
        <div class="col-4">
          <h3>SEÑAL DE CONTROL</h3>
        </div>
        <div class="col-4">
          <label style="padding-right: 5px;"> S<span style="font-size: 10px;">4</span></label>
          <label style="padding-right: 5px;"> S<span style="font-size: 10px;">3</span></label>
          <label style="padding-right: 5px;"> S<span style="font-size: 10px;">2</span></label>
          <label style="padding-right: 5px;"> S<span style="font-size: 10px;">1</span></label>
          <label style="padding-right: 5px;"> S<span style="font-size: 10px;">0</span></label>
          <br />
          <h3 style="font-weight: bold;">
            <label id="label-s4">{{ s4 or '0' }}</label> <!-- S4 -->
            <label id="label-s3">{{ s3 or '0' }}</label> <!-- S3 -->
            <label id="label-s2">{{ s2 or '0' }}</label> <!-- S2 -->
            <label id="label-s1">{{ s1 or '0' }}</label> <!-- S1 -->
            <label id="label-s0">{{ s0 or '0' }}</label> <!-- S0 -->
          </h3>
        </div>
      </div>

      <div class="row justify-content-center pt-5" style="position: relative;">
        <img src="{{ url_for('static', filename='img/circuito1.png') }}" alt="circuito1" class="p-5"
          style="width: 1300px; position: relative;" />
        <label id="label-primero" style="font-size: 24px; position: absolute; top: 65px; left: 50px;">00</label>
        <label id="label-segundo" style="font-size: 24px; position: absolute; top: 225px; left: 105px;">00</label>
        <label id="label-tercero" for="tercero"
          style="font-size: 24px; position: absolute; top: 90px; left: 1220px;">00</label>
        <label id="label-cuarto" for="cuarto"
          style="font-size: 24px; position: absolute; top: 260px; left: 1220px;">00</label>

        <!--(Botón toggle S4) -->
        <div style="position: absolute; top: 415px; left: 170px;">
          <label for="s4" style="position: absolute; top: -20px; left: 8px; color: #D9D9D9;">S₄</label>
          <button type="button" id="s4" name="s4" class="btn-toggle" data-value="0"
            style="border: 2px solid #D9D9D9; border-radius: 20px; width: 40px; height: 40px; text-align: center; background-color: gray; color: white; font-weight: bold;">
            0
          </button>
        </div>

        <!--(Botón toggle S3) -->
        <div style="position: absolute; top: 415px; left: 225px;">
          <label for="s3" style="position: absolute; top: -20px; left: 8px; color: #D9D9D9;">S₃</label>
          <button type="button" id="s3" name="s3" class="btn-toggle" data-value="0"
            style="border: 2px solid #D9D9D9; border-radius: 20px; width: 40px; height: 40px; text-align: center; background-color: gray; color: white; font-weight: bold;">
            0
          </button>
        </div>

        <!--(Botón toggle S2) -->
        <div style="position: absolute; top: 415px; left: 448px;">
          <label for="s2" style="position: absolute; top: -20px; left: 8px; color: #D9D9D9;">S₂</label>
          <button type="button" id="s2" name="s2" class="btn-toggle" data-value="0"
            style="border: 2px solid #D9D9D9; border-radius: 20px; width: 40px; height: 40px; text-align: center; background-color: gray; color: white; font-weight: bold;">
            0
          </button>
        </div>

        <!--(Botón toggle S1) -->
        <div style="position: absolute; top: 415px; left: 528px;">
          <label for="s1" style="position: absolute; top: -20px; left: 8px; color: #D9D9D9;">S₁</label>
          <button type="button" id="s1" name="s1" class="btn-toggle" data-value="0"
            style="border: 2px solid #D9D9D9; border-radius: 20px; width: 40px; height: 40px; text-align: center; background-color: gray; color: white; font-weight: bold;">
            0
          </button>
        </div>

        <!--(Botón toggle S0) -->
        <div style="position: absolute; top: 415px; left: 1030px;">
          <label for="s0" style="position: absolute; top: -20px; left: 8px; color: #D9D9D9;">S₀</label>
          <button type="button" id="s0" name="s0" class="btn-toggle" data-value="0"
            style="border: 2px solid #D9D9D9; border-radius: 20px; width: 40px; height: 40px; text-align: center; background-color: gray; color: white; font-weight: bold;">
            0
          </button>
        </div>

      </div>
    </form>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q"
    crossorigin="anonymous"></script>

  <!-- ...Nuestro Footer... -->
  {% include 'partials/footer.html' %}

</body>

<!------------------- Desarrollo UBC ----------------->
<script>
  async function devUBC() {
    console.log("Desarrollo UBC");
    const Resultado = document.getElementById("label-cuarto");
    const Carry = document.getElementById("label-tercero");
    const bin_a = document.getElementById('label-primero').textContent;
    const bin_b = document.getElementById('label-segundo').textContent;
    const control = [];
    // Iteramos desde s4 hasta s0 para construir el array en el orden deseado
    for (let i = 0; i < 5; i++) {
      const sId = `s${i}`; // Generamos el ID dinámicamente
      const element = document.getElementById(sId);
      const dataValueInt = parseInt(element.getAttribute('data-value'), 10);
      control.push(dataValueInt);
    }
    control.push(0);
    console.log(control);
    try {
      const response = await fetch('/ubc', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json' // Decirle a Flask que estamos enviando JSON
        },
        body: JSON.stringify({ // Convertir el objeto JavaScript a una cadena JSON
          "A": bin_a,
          "B": bin_b,
          "senal_control": control
        })
      });
      const data = await response.json(); // Parsear la respuesta JSON
      Resultado.textContent = data.resultado;
      Carry.textContent = data.acarreo;
    } catch (error) {
      console.error('Error POST:', error);
    }
  }
</script>


<!-- ...Despliegue de las entradas A y B... -->
<script>
  document.addEventListener('DOMContentLoaded', function () {
    // Verifica si los elementos existen antes de agregar listeners
    const inputA = document.getElementById('var_a');
    const inputB = document.getElementById('var_b');
    const labelPrimero = document.getElementById('label-primero');
    const labelSegundo = document.getElementById('label-segundo');
    const labelbin_a = document.getElementById('bin_a');
    const labelbin_b = document.getElementById('bin_b');
    const labeldec_a = document.getElementById('dec_a');
    const labeldec_b = document.getElementById('dec_b');
    const labelsdec_a = document.getElementById('sdec_a');
    const labelsdec_b = document.getElementById('sdec_b');

    if (inputA && labelPrimero) {
      inputA.addEventListener('input', async function () {
        labelPrimero.textContent = this.value.padStart(2, '0').toUpperCase();
        labelbin_a.textContent = ("00000000" + (parseInt(this.value.padStart(2, '0'), 16)).toString(2)).substr(-8);
        labeldec_a.textContent = parseInt(this.value.padStart(2, '0'), 16).toString(10);
        labelsdec_a.textContent = (parseInt(this.value.padStart(2, '0'), 16) > 127 ? -((256 - parseInt(this.value.padStart(2, '0'), 16))) : parseInt(this.value.padStart(2, '0'), 16)).toString(10);
        await devUBC(); // Llama a la función devUBC para inicializar el resultado
      });
    }

    if (inputB && labelSegundo) {
      inputB.addEventListener('input', async function () {
        labelSegundo.textContent = this.value.padStart(2, '0').toUpperCase();
        labelbin_b.textContent = ("00000000" + (parseInt(this.value.padStart(2, '0'), 16)).toString(2)).substr(-8);
        labeldec_b.textContent = parseInt(this.value.padStart(2, '0'), 16).toString(10);
        labelsdec_b.textContent = (parseInt(this.value.padStart(2, '0'), 16) > 127 ? -((256 - parseInt(this.value.padStart(2, '0'), 16))) : parseInt(this.value.padStart(2, '0'), 16)).toString(10);
        await devUBC(); // Llama a la función devUBC para inicializar el resultado
      });
    }
  });
</script>

<!-- ...Alternacion de valores de los botones S4,S3,S2,S1,S0... -->
<script>
  document.addEventListener('DOMContentLoaded', function () {
    // Selecciona todos los botones S0-S4
    const buttons = document.querySelectorAll('.btn-toggle');
    const label_s4 = document.getElementById('label-s4');
    const label_s3 = document.getElementById('label-s3');
    const label_s2 = document.getElementById('label-s2');
    const label_s1 = document.getElementById('label-s1');
    const label_s0 = document.getElementById('label-s0');


    buttons.forEach(button => {
      // Inicializa con el valor del backend (si existe)
      const initialValue = "{{ s4 }}" || "0"; // Ajusta según tu variable de Flask
      button.setAttribute('data-value', initialValue);
      button.textContent = initialValue;

      // Alterna entre 0 y 1 al hacer clic
      button.addEventListener('click', async function () {
        const newValue = this.getAttribute('data-value') === '0' ? '1' : '0';
        this.setAttribute('data-value', newValue);
        this.textContent = newValue;

        // Opcional: Cambia el color (si usas CSS)
        this.style.backgroundColor = newValue === '1' ? '#09090D' : '#A4A5A6';

        // Actualiza el valor en el label correspondiente
        label_s4.textContent = document.getElementById('s4').getAttribute('data-value');
        label_s3.textContent = document.getElementById('s3').getAttribute('data-value');
        label_s2.textContent = document.getElementById('s2').getAttribute('data-value');
        label_s1.textContent = document.getElementById('s1').getAttribute('data-value');
        label_s0.textContent = document.getElementById('s0').getAttribute('data-value');
        console.log("S4:", document.getElementById('s4').getAttribute('data-value'));
        await devUBC(); // Llama a la función devUBC para actualizar el resultado
      });
    });

  });
</script>

</html>
